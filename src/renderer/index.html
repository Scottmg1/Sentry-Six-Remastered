<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: file:;">
    <title>Sentry-Six - Tesla Dashcam Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">
                    <img src="../../assets/icon.png" alt="Sentry-Six" class="app-icon">
                    Sentry-Six
                </h1>
                <span class="app-subtitle">Tesla Dashcam Viewer</span>
            </div>
            <div class="header-center">
                <div class="playback-controls">
                    <button id="skip-back-15-btn" class="control-btn" title="Skip Back 15s">
                        <span class="icon">‚è™</span>
                    </button>
                    <button id="frame-back-btn" class="control-btn" title="Frame Back">
                        <span class="icon">‚¨ÖÔ∏è</span>
                    </button>
                    <button id="play-pause-btn" class="control-btn" title="Play/Pause">
                        <span class="icon">‚èØÔ∏è</span>
                    </button>
                    <button id="frame-forward-btn" class="control-btn" title="Frame Forward">
                        <span class="icon">‚û°Ô∏è</span>
                    </button>
                    <button id="skip-forward-15-btn" class="control-btn" title="Skip Forward 15s">
                        <span class="icon">‚è©</span>
                    </button>
                </div>
            </div>
            <div class="header-right">
                <div class="timestamp-display" id="timestamp-display">
                    --/--/---- --:--:-- --
                </div>
                <button id="debug-btn" class="control-btn debug-btn" title="Debug Timeline">
                    <span class="icon">üêõ</span>
                </button>
                <button id="camera-toggle-btn" class="control-btn" title="Camera Visibility">
                    <span class="icon">üëÅÔ∏è</span>
                </button>
                <button id="reset-camera-layout" class="control-btn" title="Reset Camera Layout">
                    <span class="icon">üîÑ</span>
                </button>
                <button id="settings-btn" class="control-btn" title="Settings">
                    <span class="icon">‚öôÔ∏è</span>
                </button>
                <button id="update-btn" class="control-btn" title="Update Sentry-Six">
                    <span class="icon">‚¨áÔ∏è</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3>Tesla Clips</h3>
                    <button id="open-folder-btn" class="btn btn-primary">
                        üìÅ Open Folder
                    </button>
                </div>
                
                <div class="sidebar-content">
                    <div id="loading-indicator" class="loading hidden">
                        <div class="spinner"></div>
                        <span>Loading Tesla files...</span>
                    </div>
                    
                    <div id="clip-list" class="clip-list">
                        <div class="no-clips-message">
                            <p>No Tesla clips loaded</p>
                            <p>Click "Open Folder" to select your Tesla dashcam folder</p>
                        </div>

                        <!-- Collapsible sections will be dynamically added here -->
                    </div>

                    <!-- Debug Panel -->
                    <div id="debug-panel" class="debug-panel" style="display: none;">
                        <div class="debug-header">
                            <span>Timeline Debug Info</span>
                            <button id="debug-toggle" class="debug-toggle">Hide</button>
                        </div>
                        <div class="debug-content">
                            <div id="debug-timeline-info"></div>
                            <div id="debug-clip-gaps"></div>
                            <div id="debug-current-state"></div>
                    <div class="debug-actions">
                        <button id="export-debug-btn" class="debug-action-btn">Export Debug Data</button>
                        <button id="export-terminal-log-btn" class="debug-action-btn">Export Terminal Log</button>
                        <button id="clear-debug-btn" class="debug-action-btn">Clear Console</button>
                        <button id="test-timeline-btn" class="debug-action-btn">Test Timeline</button>
                    </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content: video grid + timeline stacked vertically -->
            <div class="main-content" style="display: flex; flex-direction: column; flex: 1; min-width: 0; min-height: 0;">
                <!-- Camera Visibility Panel -->
                <div id="camera-visibility-panel" class="camera-panel hidden">
                    <div class="panel-header">
                        <h3>Camera Visibility</h3>
                        <button id="close-camera-panel" class="close-btn">√ó</button>
                    </div>
                    <div class="panel-content">
                        <div class="camera-toggles">
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-left_pillar" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Left Pillar</span>
                            </label>
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-front" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Front</span>
                            </label>
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-right_pillar" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Right Pillar</span>
                            </label>
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-left_repeater" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Left Repeater</span>
                            </label>
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-back" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Back</span>
                            </label>
                            <label class="camera-toggle">
                                <input type="checkbox" id="toggle-right_repeater" checked>
                                <span class="checkmark"></span>
                                <span class="camera-name">Right Repeater</span>
                            </label>
                        </div>
                        <div class="panel-actions">
                            <button id="show-all-cameras" class="panel-btn">Show All</button>
                            <button id="hide-all-cameras" class="panel-btn">Hide All</button>
                        </div>
                    </div>
                </div>

                <!-- Video Grid -->
                <section class="video-section">
                    <div class="video-grid" id="video-grid">
                        <!-- Top Row: Left Pillar, Front, Right Pillar -->

                        <!-- Left Pillar Camera -->
                        <div class="video-container" data-camera="left_pillar">
                            <div class="video-header">
                                <span class="camera-label">Left Pillar</span>
                            </div>
                            <video
                                id="video-left_pillar"
                                class="video-player"
                                data-camera="left_pillar"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>

                        <!-- Front Camera -->
                        <div class="video-container" data-camera="front">
                            <div class="video-header">
                                <span class="camera-label">Front</span>
                            </div>
                            <video
                                id="video-front"
                                class="video-player"
                                data-camera="front"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>

                        <!-- Right Pillar Camera -->
                        <div class="video-container" data-camera="right_pillar">
                            <div class="video-header">
                                <span class="camera-label">Right Pillar</span>
                            </div>
                            <video
                                id="video-right_pillar"
                                class="video-player"
                                data-camera="right_pillar"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>

                        <!-- Bottom Row: Left Repeater, Back, Right Repeater -->

                        <!-- Left Repeater Camera -->
                        <div class="video-container" data-camera="left_repeater">
                            <div class="video-header">
                                <span class="camera-label">Left Repeater</span>
                            </div>
                            <video
                                id="video-left_repeater"
                                class="video-player"
                                data-camera="left_repeater"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>

                        <!-- Back Camera -->
                        <div class="video-container" data-camera="back">
                            <div class="video-header">
                                <span class="camera-label">Back</span>
                            </div>
                            <video
                                id="video-back"
                                class="video-player"
                                data-camera="back"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>

                        <!-- Right Repeater Camera -->
                        <div class="video-container" data-camera="right_repeater">
                            <div class="video-header">
                                <span class="camera-label">Right Repeater</span>
                            </div>
                            <video
                                id="video-right_repeater"
                                class="video-player"
                                data-camera="right_repeater"
                                preload="metadata"
                                muted
                            >
                                Your browser does not support the video tag.
                            </video>
                            <div class="video-overlay">
                                <div class="video-status">No video loaded</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Timeline -->
                <footer class="timeline-section">
                    <div class="timeline-container">
                        <div class="timeline-header">
                            <span class="timeline-label">Timeline</span>
                            <div class="timeline-info">
                                <span id="current-time">00:00</span>
                                <span>/</span>
                                <span id="total-time">00:00</span>
                            </div>
                        </div>
                        <div class="timeline-track">
                            <input 
                                type="range" 
                                id="timeline-scrubber" 
                                class="timeline-scrubber"
                                min="0" 
                                max="100" 
                                value="0"
                                step="0.1"
                            >
                            <div class="timeline-markers" id="timeline-markers"></div>
                        </div>
                        <div class="timeline-controls">
                            <div class="speed-control">
                                <label for="speed-select">Speed:</label>
                                <select id="speed-select" class="speed-select">
                                    <option value="0.1">0.1x</option>
                                    <option value="0.25">0.25x</option>
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                    <option value="3">3x</option>
                                    <option value="4">4x</option>
                                </select>
                            </div>
                            <div class="volume-control">
                                <label for="volume-slider">Volume:</label>
                                <input
                                    type="range"
                                    id="volume-slider"
                                    class="volume-slider"
                                    min="0"
                                    max="1"
                                    value="0.5"
                                    step="0.1"
                                >
                            </div>
                            <div class="export-controls">
                                <button id="set-start-marker" class="export-btn" title="Set Start Marker">
                                    üìç Start
                                </button>
                                <button id="set-end-marker" class="export-btn" title="Set End Marker">
                                    üèÅ End
                                </button>
                                <button id="clear-markers" class="export-btn secondary" title="Clear Markers">
                                    üóëÔ∏è Clear
                                </button>
                                <button id="export-video" class="export-btn primary" title="Export Video">
                                    üé¨ Export
                                </button>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </main>

        <!-- Export Dialog Modal -->
        <div id="export-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Export Video</h2>
                    <button id="close-export-modal" class="close-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <!-- 1. Export Data (full width) - Combine Export Range and Export Information -->
                    <div class="export-section">
                        <div class="settings-row">
                            <div class="settings-column">
                                <h3>Export Range</h3>
                                <div class="export-range-info">
                                    <span id="export-range-display">Full Timeline</span>
                                    <span id="export-duration-display"></span>
                                </div>
                            </div>
                            <div class="settings-column">
                                <h3>Export Information</h3>
                                <div class="export-info">
                                    <div class="info-row">
                                        <span>Estimated file size:</span>
                                        <span id="estimated-file-size">Calculating...</span>
                                    </div>
                                    <div class="info-row">
                                        <span>Export duration:</span>
                                        <span id="export-duration-estimate">Calculating...</span>
                                    </div>
                                    <div style="font-size:12px; color:#666; margin-top:2px;">Actual export time may vary depending on your machine's performance.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Camera Layout (full width) - Flexible positioning system -->
                    <div class="export-section">
                        <h3>Camera Layout</h3>
                        <div class="camera-layout-container">
                            <!-- Free-form camera positioning area -->
                            <div class="camera-layout-canvas" id="camera-layout-canvas">
                                <div class="canvas-instructions">
                                    <span>Drag cameras from the sidebar to arrange your custom layout</span>
                                </div>
                            </div>

                            <!-- Camera sidebar for selection and unused cameras -->
                            <div class="camera-sidebar">
                                <h4>Available Cameras</h4>
                                <div class="camera-list">
                                    <div class="camera-item disabled" data-camera="left_pillar" draggable="true">
                                        <span class="camera-label">Left Pillar</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                    <div class="camera-item disabled" data-camera="front" draggable="true">
                                        <span class="camera-label">Front</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                    <div class="camera-item disabled" data-camera="right_pillar" draggable="true">
                                        <span class="camera-label">Right Pillar</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                    <div class="camera-item disabled" data-camera="left_repeater" draggable="true">
                                        <span class="camera-label">Left Repeater</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                    <div class="camera-item disabled" data-camera="back" draggable="true">
                                        <span class="camera-label">Back</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                    <div class="camera-item disabled" data-camera="right_repeater" draggable="true">
                                        <span class="camera-label">Right Repeater</span>
                                        <input type="checkbox" class="camera-export-toggle">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Quality Settings | Hardware Acceleration (side by side) - Already correctly positioned -->
                    <div class="export-section">
                        <div class="settings-row">
                            <div class="settings-column">
                                <h3>Quality Settings</h3>
                                <div class="quality-options">
                                    <label class="quality-option">
                                        <input type="radio" name="export-quality" value="full" checked>
                                        <div class="quality-info">
                                            <strong>Full Resolution Export</strong>
                                            <span>Original Tesla quality (larger file size)</span>
                                        </div>
                                    </label>
                                    <label class="quality-option">
                                        <input type="radio" name="export-quality" value="mobile">
                                        <div class="quality-info">
                                            <strong>Mobile Friendly Export</strong>
                                            <span>Compressed for sharing (smaller file size)</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-column">
                                <h3>Hardware Acceleration</h3>
                                <div class="hwaccel-options">
                                    <label class="hwaccel-option">
                                        <input type="checkbox" id="hwaccel-enabled">
                                        <div class="hwaccel-info">
                                            <div class="hwaccel-status-container">
                                                <div class="hwaccel-spinner" id="hwaccel-spinner"></div>
                                                <strong id="hwaccel-status">Detecting GPU...</strong>
                                            </div>
                                            <span id="hwaccel-description">Enable hardware acceleration (NVIDIA, AMD, Intel, or Mac, if available)</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Timelapse Options | Timestamp Overlay (side by side) - Moved to be adjacent -->
                    <div class="export-section">
                        <div class="settings-row">
                            <div class="settings-column">
                                <h3>Timelapse Options</h3>
                                <div class="timelapse-options">
                                    <label class="timelapse-toggle">
                                        <input type="checkbox" id="timelapse-enabled">
                                        <span>Export as Timelapse</span>
                                    </label>
                                    <div id="timelapse-settings" class="timelapse-settings hidden">
                                        <div class="timelapse-speed-selection">
                                            <label for="timelapse-speed">Timelapse Speed:</label>
                                            <div class="timelapse-speed-dropdown">
                                                <select id="timelapse-speed">
                                                    <option value="4">4x Speed (Quarter time)</option>
                                                    <option value="8">8x Speed (Eighth time)</option>
                                                    <option value="16">16x Speed</option>
                                                    <option value="30">30x Speed</option>
                                                    <option value="60" selected>60x Speed (1 minute ‚Üí 1 second)</option>
                                                    <option value="120">120x Speed (2 minutes ‚Üí 1 second)</option>
                                                    <option value="300">300x Speed (5 minutes ‚Üí 1 second)</option>
                                                    <option value="600">600x Speed (10 minutes ‚Üí 1 second)</option>
                                                    <option value="1200">1200x Speed (20 minutes ‚Üí 1 second)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="timelapse-preview">
                                            <small id="timelapse-preview-text">Preview: 20 minute export ‚Üí 20 second timelapse</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-column">
                                <h3>Timestamp Overlay</h3>
                                <div class="timestamp-options">
                                    <label class="timestamp-toggle">
                                        <input type="checkbox" id="timestamp-overlay-enabled" checked>
                                        <span>Show timestamp overlay</span>
                                    </label>
                                    <div class="timestamp-position">
                                        <label for="timestamp-position">Position:</label>
                                        <select id="timestamp-position">
                                            <option value="bottom-center" selected>Bottom Center</option>
                                            <option value="bottom-left">Bottom Left</option>
                                            <option value="bottom-right">Bottom Right</option>
                                            <option value="top-center">Top Center</option>
                                            <option value="top-left">Top Left</option>
                                            <option value="top-right">Top Right</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="export-progress" class="export-progress hidden">
                        <div class="progress-header">
                            <h3>Exporting Video...</h3>
                            <span id="progress-percentage">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                        <div class="progress-info">
                            <span id="progress-status">Preparing export...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div id="export-error-message" style="color:#c00; font-weight:bold; margin-bottom:8px; display:none;"></div>
                    <button id="cancel-export" class="btn secondary">Cancel</button>
                    <button id="start-export" class="btn primary">Start Export</button>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen hidden">
            <div class="loading-content">
                <div class="spinner large"></div>
                <h2>Loading Sentry-Six</h2>
                <p id="loading-message">Initializing application...</p>
            </div>
        </div>

        <!-- Onboarding/Welcome Modal -->
        <div id="onboarding-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Welcome to Sentry-Six</h2>
                    <button id="close-onboarding-modal" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Thank you for installing Sentry-Six, the Tesla Dashcam Viewer.</p>
                    <p>To get started, please select your TeslaCam folder (SavedClips, SentryClips, or RecentClips).</p>
                    <ul>
                        <li>Click the button below to choose your Tesla dashcam folder.</li>
                        <li>You can change this folder later from the sidebar.</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <label style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 10px;">
                        <input type="checkbox" id="onboarding-dont-show" />
                        Don't show this again
                    </label>
                    <button id="onboarding-select-folder" class="btn primary">
                        <span id="onboarding-folder-spinner" class="spinner small" style="display:none; margin-right:8px;"></span>
                        Select TeslaCam Folder
                    </button>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="debug-manager.js"></script>
        <script src="app.js"></script>
    </div>
</body>
</html>
